function makeWorker(c,f){if("script"==c)try{var a=new Blob([f]);worker=new Worker(URL.createObjectURL(a));URL.revokeObjectURL(a)}catch(b){worker=new Worker(f)}else worker=new Worker(f);return worker}var FileReaderSyncSupport=!1,syncDetectionScript="onmessage = function(e) { postMessage(!!FileReaderSync); };",fileOpenWorker;checkFileReaderSyncSupport();var releaseWorker=function(){fileOpenWorker.terminate()};
function checkFileReaderSyncSupport(){if(fileOpenWorker=makeWorker("url",KEditorLayerWin._k_editor._config.fileEncodingWorkerJSUrl+"?ver="+KEDITORTOP.RAONKEDITOR.ReleaseVer))fileOpenWorker.onmessage=function(c){FileReaderSyncSupport=c.data.result;releaseWorker()},fileOpenWorker.postMessage({init:!0})}
function processFiles(c,f){if(FileReaderSyncSupport){var a=makeWorker("url",KEditorLayerWin._k_editor._config.fileEncodingWorkerJSUrl+"?ver="+KEDITORTOP.RAONKEDITOR.ReleaseVer);a&&(a.onmessage=function(a){f(a.data.hasBom,a.data.result)},Array.prototype.forEach.call(c,function(b){a.postMessage(b)}))}}
function handleFileSelect(c){FileReaderSyncSupport&&processFiles(c,function(c,a){if(0==a.indexOf("[KEditorError]"))alert(a),event_keditor_open_file_upload_completed("");else{var b=a.toLowerCase(),g,e,d;g=b.indexOf("<!doctype");e=b.indexOf("<html");d=b.indexOf("<head");0>d&&(d=b.indexOf("<meta"));0>d&&(d=b.indexOf("<title"));b=b.indexOf("<body");-1<g&&g<e&&e<b?a=a.substring(g):-1<e&&e<b?a=a.substring(e):-1<d&&d<b?a=a.substring(d):-1<b&&(a=a.substring(b));event_keditor_open_file_upload_completed(a)}releaseWorker()})}
;
