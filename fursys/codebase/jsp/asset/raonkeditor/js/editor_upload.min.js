function uploadAjaxOnprogressStart(a,b){KEDITORTOP.G_CURRKEDITOR.xhr_onprogress=new XMLHttpRequest;var c=KEDITORTOP.G_CURRKEDITOR.xhr_onprogress;c.upload.onprogress=function(a){try{var d=KEDITORTOP.RAONKEDITOR.util.parseIntOr0(a.loaded/a.total*100),b=document.getElementById("keditor_loading");b&&b.childNodes&&(b.childNodes[1].nodeValue=" Uploading... "+d+"%")}catch(c){loading_image_show(!1)}};c.onload=function(){if(c){var a;200==c.status?(a=c.responseText,a=KEDITORTOP.RAONKEDITOR.util.parseDataFromServer(a),
0==a.indexOf("[OK]")?(a=a.replace("[OK]",""),a=KEDITORTOP.RAONKEDITOR.util.makeDecryptReponseMessage(a)):0==a.indexOf("[FAIL]")&&(a=a.replace("[FAIL]",""),a="[FAIL]"+KEDITORTOP.RAONKEDITOR.util.makeDecryptReponseMessage(a))):a="[FAIL]File Upload Error";c=null;loading_image_show(!1);b(a)}};c.onerror=function(){c=null;loading_image_show(!1);b("[FAIL]File Upload Error")};var d=new FormData;a.formData&&0<a.formData.length&&a.formData.each(function(a,b){d.append(a,b)});a.fileObj&&d.append(a.fileID,a.fileObj[0]);
c.open("POST",a.handlerUrl,!0);c.send(d)}function uploadAjaxOnprogressCancel(){if(KEDITORTOP.G_CURRKEDITOR.xhr_onprogress)try{KEDITORTOP.G_CURRKEDITOR.xhr_onprogress.abort(),KEDITORTOP.G_CURRKEDITOR.xhr_onprogress=null}catch(a){}}
function setDragAndDropEvent(a){a=document.getElementById(a);KEDITORTOP.RAONKEDITOR.util.addEvent(a,"dragenter",upload_DragEnter);KEDITORTOP.RAONKEDITOR.util.addEvent(a,"dragover",upload_DragOver);KEDITORTOP.RAONKEDITOR.util.addEvent(a,"drop",upload_Drop);KEDITORTOP.RAONKEDITOR.util.addEvent(a,"click",upload_Drop_zone_click);KEDITORTOP.RAONKEDITOR.util.addEvent(a,"dragleave",upload_DragLeave)}
function upload_DragEnter(a){"1"==KEDITORTOP.G_CURRKEDITOR._config.useKManager&&useManagerDropZone(a);try{a.stopPropagation(),a.preventDefault()}catch(b){KEDITORTOP.RAONKEDITOR.util.cancelEvent(a)}}
function upload_DragOver(a){if("0"==KEDITORTOP.G_CURRKEDITOR._config.useKManager){var b="drop_zone";a.currentTarget&&a.currentTarget.getAttribute("id")&&(b=a.currentTarget.getAttribute("id"));document.getElementById(b).style.border="solid 1px gray";document.getElementById(b).style.backgroundColor="#EDEDED"}try{a.stopPropagation(),a.preventDefault()}catch(c){KEDITORTOP.RAONKEDITOR.util.cancelEvent(a)}}
function upload_DragLeave(a){if("0"==KEDITORTOP.G_CURRKEDITOR._config.useKManager){var b="drop_zone";a.currentTarget&&a.currentTarget.getAttribute("id")&&(b=a.currentTarget.getAttribute("id"));document.getElementById(b).style.border="dashed 1px gray";document.getElementById(b).style.backgroundColor="#FFFFFF"}try{a.stopPropagation(),a.preventDefault()}catch(c){KEDITORTOP.RAONKEDITOR.util.cancelEvent(a)}}
function upload_Drop(a){if("0"==KEDITORTOP.G_CURRKEDITOR._config.useKManager){var b="drop_zone";a.currentTarget&&a.currentTarget.getAttribute("id")&&(b=a.currentTarget.getAttribute("id"));document.getElementById(b).style.border="dashed 1px gray";document.getElementById(b).style.backgroundColor="#FFFFFF";b="";null!=document.getElementById("drop_zone_uploadtype")&&(b=document.getElementById("drop_zone_uploadtype").value);a.currentTarget&&a.currentTarget.getAttribute("drop_zone_uploadtype")&&(b=a.currentTarget.getAttribute("drop_zone_uploadtype"));
var c="file_text";a.currentTarget&&a.currentTarget.getAttribute("file_text")&&(c=a.currentTarget.getAttribute("file_text"));G_dragDropFileObj=a.dataTransfer.files;switch(b){default:document.getElementById(c).value=a.dataTransfer.files[0].name,document.getElementById(c).setAttribute("value",a.dataTransfer.files[0].name)}fileOnchange(G_dragDropFileObj,b,a)}KEDITORTOP.RAONKEDITOR.util.cancelEvent(a)}
function upload_Drop_zone_click(a){var b="Filedata",c="";null!=document.getElementById("drop_zone_uploadtype")&&(c=document.getElementById("drop_zone_uploadtype").value);a.currentTarget&&a.currentTarget.getAttribute("drop_zone_uploadtype")&&(c=a.currentTarget.getAttribute("drop_zone_uploadtype"),b+="_"+c);null==document.getElementById(b)&&(b=KEDITORTOP.G_CURRKEDITOR._config.fileFieldID);if("1"==KEDITORTOP.G_CURRKEDITOR._config.useKManager){a=null;switch(c){case "image":case "input_image":a=1;"1"==
KEDITORTOP.G_CURRKEDITOR._config.insertMultiImage&&"image"==c&&null==elemModify&&(a=0);a={agentCmd:"KC01",maxTotalCount:a,maxOneFileSize:0,limitOrAllow:0,limitOrAllowExt:"",getSize:1,callBack:function(a){"image"==c&&(g_curr_width=[],g_curr_height=[]);for(var b={files:[]},e=a.length,f=0;f<e;f++)b.files.push({name:a[f].path.substring(a[f].path.lastIndexOf("\\")+1),size:a[f].size,path:a[f].path,width:a[f].width,height:a[f].height}),"image"==c&&(g_curr_width.push(a[f].width),g_curr_height.push(a[f].height));
fileOnchange(b,c)}};break;case "video":case "video_media":case "poster_media":a={agentCmd:"KC01",maxTotalCount:1,maxOneFileSize:0,limitOrAllow:0,limitOrAllowExt:"",getSize:0,callBack:function(a){var b={files:[]};b.files.push({name:a[0].path.substring(a[0].path.lastIndexOf("\\")+1),size:a[0].size,path:a[0].path});fileOnchange(b,c,"drop_zone_"+c)}};break;case "insert_file":case "hyperlink_image":case "flash":case "media":case "m_image":case "doc_bg_image":case "cell_bg_image":case "p_table_bg_image":case "table_bg_image":a=
{agentCmd:"KC01",maxTotalCount:1,maxOneFileSize:0,limitOrAllow:0,limitOrAllowExt:"",getSize:0,callBack:function(a){var b={files:[]};b.files.push({name:a[0].path.substring(a[0].path.lastIndexOf("\\")+1),size:a[0].size,path:a[0].path});fileOnchange(b,c,"drop_zone")}}}-1<c.indexOf("image")&&(a.filter="images|*.jpg;*.jpeg;*.png;*.gif;*.bmp;*.tif;*.tiff");LayerWin.agentFileSelect(a)}else document.getElementById(b).click()}
function useManagerDropZone(a,b){var c;c=KEDITORTOP.G_CURRKEDITOR;a.currentTarget&&(currentTargetID=a.currentTarget.id);var d=a.screenX-a.clientX,h=a.screenY-a.clientY;if("1"==c._config.useKManager){if(KEDITORTOP.RAONKEDITOR.browser.chrome||KEDITORTOP.RAONKEDITOR.browser.opera)h=window.screenY+h;window.screenX>=d?(d+=window.screenX,KEDITORTOP.RAONKEDITOR.browser.chrome&&(d+=5)):5>=window.screenX&&(KEDITORTOP.RAONKEDITOR.browser.chrome||KEDITORTOP.RAONKEDITOR.browser.opera)&&(d=window.screenX+d,KEDITORTOP.RAONKEDITOR.browser.chrome&&
(d+=5));var e=null,e=null==b||void 0==b?document.getElementById("drop_zone"):b,e=KEditorLayerWin.getClientRect(e),f=e.right-e.left,p=e.bottom-e.top;b&&(0>b.className.indexOf("raonkdropzone_over")&&(b.className=b.className.replace("raonkdropzone","raonkdropzone_over")),d+=e.left,h+=e.top);var g=[["kcmd","KC02"]];g.push(["k16",c._config.managerLang]);g.push(["k17",0]);g.push(["k40",0]);g.push(["s01",encodeURIComponent("*.*")]);var m=1;"1"==KEDITORTOP.G_CURRKEDITOR._config.insertMultiImage&&(m=0);g.push(["s02",
m+""]);g.push(["s03","0"]);g.push(["s04","0"]);g.push(["s05",0]);g.push(["s06",0]);g.push(["s07",encodeURIComponent("")]);d=d+e.left+KEDITORTOP.RAONKSolution.Agent.vertical;d+=h+e.top+KEDITORTOP.RAONKSolution.Agent.vertical;d+=f+KEDITORTOP.RAONKSolution.Agent.vertical;d+=p+KEDITORTOP.RAONKSolution.Agent.vertical;d+=c._config.dropZoneTransparency;g.push(["kp1",d]);g.push(["kp2",1]);var l=KEditorLayerWin.setManagerParam("{}",g),l=KEDITORTOP.RAONKSolution.Agent.makeEncryptManagerParam(l),n=function(a){KEDITORTOP.RAONKEDITOR.IsCreatedDropZone=
!1;b&&(b.className=b.className.substring(0,b.className.length-5));a=KEDITORTOP.RAONKSolution.Agent.parseRtn(a);var c=a.code;a=a.valueArr;if(1E3==c){var c={files:[]},d=null,e=null;null!=document.getElementById("drop_zone_uploadtype")&&(d=document.getElementById("drop_zone_uploadtype").value);null!=document.getElementById(currentTargetID)&&null!=document.getElementById(currentTargetID).getAttribute("drop_zone_uploadtype")&&(e=document.getElementById(currentTargetID).getAttribute("drop_zone_uploadtype"));
for(var g=a.length,f=0;f<g;f++){var k=a[f].split(KEDITORTOP.RAONKSolution.Agent.formfeed),h={path:k[1],name:k[1].substring(k[1].lastIndexOf("\\")+1),size:k[2],width:0,height:0};void 0!=k[3]&&(h.width=KEDITORTOP.RAONKEDITOR.util.parseIntOr0(k[3]),h.height=KEDITORTOP.RAONKEDITOR.util.parseIntOr0(k[4]));c.files.push(h);"image"==d&&(g_curr_width.push(h.width),g_curr_height.push(h.height))}null==e?fileOnchange(c,d,"drop_zone"):fileOnchange(c,e,"drop_zone_"+e)}else 2E3!=c&&2001==c&&KEditorLayerWin.sendMessageToAgent(l,
n,null,!0)};KEDITORTOP.RAONKEDITOR.IsCreatedDropZone&&c.lastAgentCmd==l||(KEDITORTOP.RAONKEDITOR.IsCreatedDropZone=!0,c.lastAgentCmd=l,KEditorLayerWin.sendMessageToAgent(l,n,null,!0))}};
